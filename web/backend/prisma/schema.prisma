generator client {
  provider   = "prisma-client-js"
  engineType = "library"
}

datasource db {
  provider = "postgresql"
}

model User {
  id                   String           @id @default(uuid())
  name                 String
  identificationNumber String?          @unique
  phoneNumber          String           @unique
  password             String
  role                 Role             @default(CITIZEN)
  createdAt            DateTime         @default(now())
  updatedAt            DateTime         @updatedAt
  appointments         Appointment[]
  notifications        Notification[]
  officerQueues        Queue[]          @relation("OfficerQueues")
  queues               Queue[]
  officerRequests      ServiceRequest[] @relation("OfficerProcesses")
  requests             ServiceRequest[] @relation("CitizenRequests")
  logs                 SystemLog[]
}

model Notification {
  id        String   @id @default(uuid())
  title     String
  message   String
  type      String   @default("INFO")
  isRead    Boolean  @default(false)
  userId    String
  relatedId String?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  user      User     @relation(fields: [userId], references: [id])
}

model SystemLog {
  id        String   @id @default(uuid())
  action    String
  details   String?
  userId    String?
  createdAt DateTime @default(now())
  user      User?    @relation(fields: [userId], references: [id])
}

model ServiceSector {
  id          String    @id @default(uuid())
  name        String    @unique
  description String?
  icon        String?
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
  services    Service[]
}

model Service {
  id           String           @id @default(uuid())
  name         String
  description  String?
  mode         ServiceMode
  availability String?
  icon         String?
  sectorId     String
  createdAt    DateTime         @default(now())
  updatedAt    DateTime         @updatedAt
  appointments Appointment[]
  queues       Queue[]
  sector       ServiceSector    @relation(fields: [sectorId], references: [id])
  requests     ServiceRequest[]
}

model Queue {
  id           String      @id @default(uuid())
  ticketNumber Int
  status       QueueStatus @default(WAITING)
  userId       String
  serviceId    String
  officerId    String?
  remarks      String?
  createdAt    DateTime    @default(now())
  updatedAt    DateTime    @updatedAt
  officer      User?       @relation("OfficerQueues", fields: [officerId], references: [id])
  service      Service     @relation(fields: [serviceId], references: [id])
  user         User        @relation(fields: [userId], references: [id])

  @@index([createdAt])
}

model Appointment {
  id        String            @id @default(uuid())
  date      DateTime
  timeSlot  String
  status    AppointmentStatus @default(PENDING)
  userId    String
  serviceId String
  createdAt DateTime          @default(now())
  updatedAt DateTime          @updatedAt
  service   Service           @relation(fields: [serviceId], references: [id])
  user      User              @relation(fields: [userId], references: [id])
}

model ServiceRequest {
  id        String        @id @default(uuid())
  status    RequestStatus @default(PENDING)
  data      Json?
  remarks   String?
  userId    String
  serviceId String
  officerId String?
  createdAt DateTime      @default(now())
  updatedAt DateTime      @updatedAt
  officer   User?         @relation("OfficerProcesses", fields: [officerId], references: [id])
  service   Service       @relation(fields: [serviceId], references: [id])
  user      User          @relation("CitizenRequests", fields: [userId], references: [id])
}

model SystemSetting {
  id        String   @id @default(uuid())
  key       String   @unique
  value     Json
  updatedAt DateTime @updatedAt
}

enum Role {
  CITIZEN
  HELPDESK
  OFFICER
  ADMIN
}

enum ServiceMode {
  ONLINE
  QUEUE
  APPOINTMENT
}

enum QueueStatus {
  WAITING
  CALLING
  PROCESSING
  COMPLETED
  REJECTED
}

enum AppointmentStatus {
  PENDING
  SCHEDULED
  COMPLETED
  CANCELLED
  REJECTED
}

enum RequestStatus {
  PENDING
  PROCESSING
  COMPLETED
  REJECTED
  FORWARDED
}
